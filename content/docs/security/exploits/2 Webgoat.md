---
title: "WebGoat"
weight: 4
bookToc: true
---

## 环境

使用Docker快速搭建`WebGoat`靶场环境，[https://github.com/WebGoat/WebGoat](https://github.com/WebGoat/WebGoat)
```bash
docker run -d --name webgoat -p 8080:8080 -p 9090:9090 webgoat/webgoat
```

部署完后访问[http://localhost:8080/WebGoat](http://localhost:8080/WebGoat)，随便注册一个用户


## A1 Broken Access Control

### Hijack a session

**目标：通过预测`hijack_cookie`的值，获取其他已认证用户的会话。**

`Proxy`->`HTTP history`->`Send to Repeater`

![](/data/image/security/exploit/webgoat/A1/hijack/1.png)

删除`Cookie`头中的`hijack_cookie`，发送2次，得到`hijack_cookie`的值分别是
```
hijack_cookie=6870830967335141386-1768376122121
hijack_cookie=6870830967335141387-1768376130183
```

推测出来`hijack_cookie`可能前半部分是个随机数，后半部分是个时间戳。

**那么中间缺失的`xxxx-1768376122121`/`xxxx-1768376130183`可能代表其他已认证用户的会话。**

右键`Send to Intruder`，`Payloads`选择`Numbers`，`From xxx to xxx`，`Start attack`

TODO

`Sequencer`分析得出结论`extremely poor`

![](/data/image/security/exploit/webgoat/A1/hijack/0.png)

### Insecure Direct Object References

先以`tom/cat`登录

![](/data/image/security/exploit/webgoat/A1/idor/image-1.png)

找请求和页面显示的差异，可能收获一些信息 `role,userId`

![](/data/image/security/exploit/webgoat/A1/idor/image.png)

推测访问profile的REST API风格，为 `WebGoat/IDOR/profile/2342384`

![](/data/image/security/exploit/webgoat/A1/idor/image-2.png)

`Send to Intruder`爆破其他人的profile
![](/data/image/security/exploit/webgoat/A1/idor/image-3.png)

爆破成功其他id为`2342388`
![](/data/image/security/exploit/webgoat/A1/idor/image-4.png)

同样的路径，方法改为PUT，修改其他人的profile，将`role`修改为`0`，`color`改为`red`，一般数字低的代表管理员等高权限
![](/data/image/security/exploit/webgoat/A1/idor/image-5.png)


### Missing Function Level Access Control

![](/data/image/security/exploit/webgoat/A1/missingac/image.png)

![](/data/image/security/exploit/webgoat/A1/missingac/image-2.png)