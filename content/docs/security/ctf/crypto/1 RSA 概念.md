---
title: "RSA 概念"
weight: 1
bookToc: true
---

## RSA简介及证明

RSA(Rivest–Shamir–Adleman)是一种公钥密码系统，被广泛应用于安全数据传输。RSA名称来自其发明者的姓名首字母缩写：Ron Rivest，Adi Shamir和Leonard Adleman。该系统通过使用两个大质数生成公钥和私钥来工作。公钥可以自由分发，而私钥必须保密

当某人想要向公钥所有者发送消息时，他们使用公钥加密消息。只有私钥的所有者才能解密消息，确保通信保持机密性

RSA被认为是非常安全的加密方法，因为它依赖于目前认为分解两个大质数乘积的因子在常规时间是不可行的事实

#### 算法步骤

RSA加密算法主要步骤如下：
1. 选择2个大质数 p 和 q，计算出模数 N = p * q，N 作为公私密钥共同的模，N可以公开，p 和 q 不公开私密保留
2. 计算欧拉函数 φ(N) = (p - 1) * (q - 1)，φ(N) 不公开私密保留
3. 选择一个e(1 < e < φ(N))，且 e 和  φ(N) 互质，e 可以公开
4. 取 e 的模逆元为 d，ed ≡ 1 (mod φ(n)) ，d 不公开私密保留

公钥（可以公开）：e和N  
私钥（不可以公开）：d

加密：c = m^e (mod N)，得到的 c 即为密文  
解密：m = c^d (mod N)，得到的 m 即为明文

#### 算法证明

RSA算法可以抽象为两个映射：加密映射 E(x) 和 解密映射 D(x)，满足
```
D(E(x)) = x
```
解密性证明如下：
```
D(E(x)) ≡ (E(x))^d (mod N)
        ≡ x^ed
        ≡ x^(φ(N)k)x      (根据ed的取值关系，ed = kφ(N) + 1)
        ≡ (1^k)x          (根据欧拉定理，a^φ(N) ≡ 1 (mod N))
        ≡ x
```

因为 p 和 q都是大素数，x 和 n = pq 不互质的概率很低，所以直接忽略了不互质的情况

#### Q&A

1. 解密性证明方法主要用到了什么定理
{{< expand "" "..." >}}
> Rivest、Shamir和Adleman的原始论文使用的是费马小定理来解释RSA如何工作的，但是用欧拉定理的证明也是很常见的，如上使用欧拉定理证明
{{< /expand >}}

2. e 的取值
{{< expand "" "..." >}}
> e需要和 φ(N) 互质，这样才能求解 d。e 的取值是安全性和性能的综合考虑，e 如果具有较短的bit长度和较小的汉明重量则会提升算法性能。更常见 e 的取值为 2^16 + 1 = 65537（对应十六进制为 0x10001），最小的取值为 3，性能也最好。一般实现如 PKCS#1 是先固定 e 的值，如固定 e 为 65537 质数，然后确定 φ(n) 不是 e 的倍数即可
{{< /expand >}}

3. 算法是对数字进行加密，实际使用场景主要是文本，数字和文本怎么对应的
{{< expand "" "..." >}}
> 在RSA中，数据被分成较小的块进行加密，块的bit长度不超过 N 的bit长度，每块数据本质是一串二进制位，可以转换成数字。对称加密算法与此不同，使用的是相同的密钥
{{< /expand >}}

4. p、q 为 大质数，构造这2个大质数复杂吗
{{< expand "" "..." >}}
> 根据素数定理，在 k 位十进制正整数中遇到素数的概率约等于 2/ln(10^k)，这个概率并不低；同时可以借助素数检测类方法如Miller-Rabin检测法，可以快速地判断一个数是不是素数。综合起来，得到两个大素数并不需要花很多时间以及计算机算力
{{< /expand >}}

5. RSA算法中哪些部分是可以公开的，哪些部分是不可以公开的
{{< expand "" "..." >}}
> 公开：N, e  
> 私密：p和q, φ(n), d  
> 实际上，p和q, φ(n)只是用于求 d，**当 d 的值求出确定后，p和q, φ(n)都可以丢弃不保存**
{{< /expand >}}

6. RSA 算法的安全性体现在哪
{{< expand "" "..." >}}
> N，e可以公开，d 的求值依赖 φ(n) 和 e，φ(n) 的求值等价于 N 的质因数分解，**所以难度最终依赖于大数的质因数分解问题**，所以 p 和 q 不能公开，N，e可以公开。RSA 的安全性依赖于大数的质因数分解，但是否等同于大数的质因数分解一直未能得到理论上的证明，也并没有从理论上证明破译，万一后续有了高效地求解 φ(n) 方法
{{< /expand >}}

7. 常说的1024/2048长度的RSA密钥，这个长度指的是什么的长度
{{< expand "" "..." >}}
RSA密钥的长度一般为 1024bits ~ 4096bits，这个长度指的是模 N 的长度，使用 openssl 生成密钥时指定长度如 2048bits，也会有一定 bit 的偏差，不会保证固定为如 2048bits。同时1024bits以下的密钥已经不建议实际使用
{{< /expand >}}

8. RSA 算法限制只能使用p、q两个质数吗？
{{< expand "" "..." >}}
只要保证以下几个条件，可以使用多个质数（因为加解密，涉及到e、d、n，求d涉及phi_n，并没有限制p、q的个数）：
1. n = p1 * p2 * p3 * ... * pk（是多个大质数的乘积）
2. φ(n) = (p1 - 1)(p2 - 1)...(pk - 1)（质数互不相同）
3. e 和 φ(n) 互质，可以算出 d = e⁻¹ mod φ(n)

实际应用中使用两个质数是综合性能、安全等考虑的结果。
{{< /expand >}}
