---
title: "命令注入" 
weight: 6
bookToc: true
---

## 代码

命令注入是由于对用户输入限制不足，导致改变了原有执行命令的语义，继而额外执行了多条命令，如下面的`ping`程序，原本设计是期待用户传入合法的ip参数，如`127.0.0.1`，程序返回`ping 127.0.0.1`的结果，但用户可以通过修改 ip 参数来注入恶意的命令

{{< tabs "命令注入-ping程序" >}}
{{< tab "php版本" >}}
```php
<?php
highlight_file(__FILE__);

// 获取用户输入的IP地址
$ip_address = $_GET['ip'];

// 构建ping命令
$command = "ping -c 4 " . $ip_address;

// 执行命令
$output = shell_exec($command);

// 显示结果
echo "<pre>$output</pre>";
?>
```
{{< /tab >}}
{{< tab "python版本" >}}
```python
import os
from flask import Flask, request

app = Flask(__name__)

@app.route('/ping', methods=['GET'])
def ping():
    # 获取用户输入的IP地址
    ip_address = request.args.get('ip')
    
    # 构建ping命令
    command = f"ping -c 4 {ip_address}"
    
    # 执行命令
    output = os.popen(command).read()
    
    # 返回结果
    return f"<pre>{output}</pre>"

if __name__ == '__main__':
    app.run(debug=True)
```
{{< /tab >}}
{{< /tabs >}}

如用户输入`?ip=127.0.0.1;pwd`可额外获取当前目录信息

![](/data/image/web-cmdinject.jpg)

## 连接符

## 绕过
